<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ì°° ì¬ë‚œê´€ë¦¬ ì‹œìŠ¤í…œ (Real-time)</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#16213e">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0f172a; --card-bg: #1e293b; --text: #f8fafc;
            --rain: #38bdf8; --snow: #f1f5f9; --fire: #fb7185; --heat: #fbbf24;
            --police: #1d4ed8;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg-dark); color: var(--text); margin: 0; padding: 15px; }
        
        /* í—¤ë” & ìƒíƒœë°” */
        header { text-align: center; margin-bottom: 20px; }
        .system-status { font-size: 0.8rem; color: #4ade80; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .live-dot { width: 8px; height: 8px; background: #4ade80; border-radius: 50%; animation: blink 2s infinite; }
        
        /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ */
        .dashboard-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .card { 
            background: var(--card-bg); border-radius: 16px; padding: 20px; 
            text-align: center; border: 1px solid #334155; position: relative; cursor: pointer;
        }
        .card:active { transform: scale(0.98); background: #334155; }
        .card i { font-size: 2.5rem; margin-bottom: 10px; display: block; }
        .card h3 { margin: 0; font-size: 1rem; color: #94a3b8; }
        .data-val { font-size: 1.4rem; font-weight: bold; margin: 5px 0; display: block; }
        .badge { font-size: 0.75rem; padding: 4px 8px; border-radius: 6px; background: rgba(255,255,255,0.1); }
        
        /* ìœ„í—˜ë„ë³„ ìƒ‰ìƒ í´ë˜ìŠ¤ */
        .safe { color: #4ade80; border-color: #4ade80; }
        .warn { color: #facc15; border-color: #facc15; }
        .danger { color: #fb7185; border-color: #fb7185; animation: pulse 2s infinite; }

        /* ëª¨ë‹¬ì°½ */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; justify-content: center; align-items: center; }
        .modal-box { background: #1e293b; width: 85%; padding: 20px; border-radius: 15px; border: 1px solid var(--police); }
        .modal-header { border-bottom: 1px solid #334155; padding-bottom: 10px; margin-bottom: 10px; font-weight: bold; font-size: 1.2rem; }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #334155; font-size: 0.9rem; }
        .close-btn { width: 100%; padding: 12px; background: var(--police); border: none; color: white; border-radius: 8px; margin-top: 15px; font-weight: bold; cursor: pointer; }

        /* ë¡œê·¸ */
        #log-box { background: #000; padding: 15px; border-radius: 10px; height: 150px; overflow-y: auto; font-family: monospace; font-size: 0.8rem; border: 1px solid #334155; }
        .log-item { margin-bottom: 5px; border-bottom: 1px solid #1e293b; padding-bottom: 3px; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(251, 113, 133, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(251, 113, 133, 0); } 100% { box-shadow: 0 0 0 0 rgba(251, 113, 133, 0); } }
    </style>
</head>
<body>

<header>
    <h2><i class="fas fa-satellite-dish"></i> ê²½ì°° ì¬ë‚œê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
    <div class="system-status">
        <div class="live-dot"></div>
        <span id="last-update">ë°ì´í„° ìˆ˜ì‹  ëŒ€ê¸° ì¤‘...</span>
    </div>
    <div style="margin-top:5px; font-size:0.9rem; color:var(--rain);">
        <i class="fas fa-location-dot"></i> í˜„ì¬ ê´€ì¸¡: <b>ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</b>
    </div>
</header>

<div class="dashboard-grid">
    <div class="card" onclick="showDetail('rain')">
        <i class="fas fa-cloud-showers-heavy" style="color:var(--rain)"></i>
        <h3>ê°•ìˆ˜ëŸ‰ (ì‹œê°„ë‹¹)</h3>
        <span class="data-val" id="val-rain">--</span>
        <span class="badge" id="badge-rain">ë¶„ì„ì¤‘</span>
    </div>

    <div class="card" onclick="showDetail('snow')">
        <i class="fas fa-snowflake" style="color:var(--snow)"></i>
        <h3>ì ì„¤ëŸ‰</h3>
        <span class="data-val" id="val-snow">--</span>
        <span class="badge" id="badge-snow">ë¶„ì„ì¤‘</span>
    </div>

    <div class="card" onclick="showDetail('fire')">
        <i class="fas fa-fire" style="color:var(--fire)"></i>
        <h3>ì‚°ë¶ˆìœ„í—˜ì§€ìˆ˜</h3>
        <span class="data-val" id="val-fire">--</span>
        <span class="badge" id="badge-fire">ë¶„ì„ì¤‘</span>
    </div>

    <div class="card" onclick="showDetail('temp')">
        <i class="fas fa-temperature-half" style="color:var(--heat)"></i>
        <h3>í˜„ì¬ ê¸°ì˜¨</h3>
        <span class="data-val" id="val-temp">--</span>
        <span class="badge" id="badge-temp">ë¶„ì„ì¤‘</span>
    </div>
</div>

<div id="log-box">
    <div class="log-item" style="color:#facc15">[SYSTEM] ìœ„ì„± ë°ì´í„° ì—°ê²° ì‹œë„...</div>
</div>

<div id="modal-overlay">
    <div class="modal-box">
        <div class="modal-header" id="modal-title">ìƒì„¸ ì •ë³´</div>
        <div id="modal-content"></div>
        <div style="margin-top:15px; padding:10px; background:#0f172a; border-radius:8px; font-size:0.85rem; color:#38bdf8;">
            <strong>ğŸ‘® ê²½ì°° ì¡°ì¹˜ì‚¬í•­:</strong><br>
            <span id="police-action">-</span>
        </div>
        <button class="close-btn" onclick="closeModal()">ë‹«ê¸°</button>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜ë¡œ ë°ì´í„° ì €ì¥
    let currentData = { rain: 0, snow: 0, temp: 0, humid: 0, wind: 0, fireIdx: 0 };

    window.onload = function() {
        getRealTimeWeather();
        // 5ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ 
        setInterval(getRealTimeWeather, 300000);
    };

    async function getRealTimeWeather() {
        addLog("SYSTEM", "Open-Meteo API ë°ì´í„° ìš”ì²­ ì¤‘...");
        
        try {
            // ì„¸ì¢…ì‹œ ìœ„ë„: 36.48, ê²½ë„: 127.28
            const url = "https://api.open-meteo.com/v1/forecast?latitude=36.48&longitude=127.28&current=temperature_2m,relative_humidity_2m,rain,snowfall,wind_speed_10m&timezone=Asia%2FTokyo";
            const response = await fetch(url);
            const json = await response.json();
            const now = json.current;

            // ë°ì´í„° ë§¤í•‘
            currentData.temp = now.temperature_2m;
            currentData.humid = now.relative_humidity_2m;
            currentData.rain = now.rain;
            currentData.snow = now.snowfall;
            currentData.wind = now.wind_speed_10m;

            // ì‚°ë¶ˆì§€ìˆ˜ ìì²´ ê³„ì‚° (ìŠµë„ì™€ í’ì† ì´ìš©í•œ ì•½ì‹ ê³µì‹)
            // ìŠµë„ê°€ ë‚®ì„ìˆ˜ë¡(ë°˜ë¹„ë¡€), í’ì†ì´ ì…€ìˆ˜ë¡(ë¹„ë¡€) ìœ„í—˜
            let fireRisk = (100 - currentData.humid) + (currentData.wind * 2);
            if(currentData.temp > 25) fireRisk += 10; // ê³ ì˜¨ì¼ ê²½ìš° ê°€ì‚°ì 
            currentData.fireIdx = Math.min(Math.round(fireRisk), 100); // ìµœëŒ€ 100

            updateUI();
            
            const timeStr = new Date().toLocaleTimeString();
            document.getElementById('last-update').innerText = `ìµœì¢… ìˆ˜ì‹ : ${timeStr}`;
            addLog("SUCCESS", `ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ (ê¸°ì˜¨ ${currentData.temp}Â°C)`);

        } catch (error) {
            console.error(error);
            addLog("ERROR", "ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        }
    }

    function updateUI() {
        // 1. ê°•ìˆ˜ëŸ‰
        const rainEl = document.getElementById('val-rain');
        const rainBadge = document.getElementById('badge-rain');
        rainEl.innerText = `${currentData.rain}mm`;
        if(currentData.rain > 30) { setStatus(rainBadge, 'danger', 'í˜¸ìš°ê²½ë³´'); }
        else if(currentData.rain > 5) { setStatus(rainBadge, 'warn', 'í˜¸ìš°ì£¼ì˜'); }
        else { setStatus(rainBadge, 'safe', 'ì •ìƒ'); }

        // 2. ì ì„¤ëŸ‰
        const snowEl = document.getElementById('val-snow');
        const snowBadge = document.getElementById('badge-snow');
        snowEl.innerText = `${currentData.snow}cm`;
        if(currentData.snow > 5) { setStatus(snowBadge, 'danger', 'ëŒ€ì„¤ê²½ë³´'); }
        else if(currentData.snow > 1) { setStatus(snowBadge, 'warn', 'ì œì„¤í•„ìš”'); }
        else { setStatus(snowBadge, 'safe', 'ì ì„¤ì—†ìŒ'); }

        // 3. ì‚°ë¶ˆìœ„í—˜
        const fireEl = document.getElementById('val-fire');
        const fireBadge = document.getElementById('badge-fire');
        fireEl.innerText = currentData.fireIdx;
        if(currentData.fireIdx > 80) { setStatus(fireBadge, 'danger', 'ë§¤ìš°ìœ„í—˜'); }
        else if(currentData.fireIdx > 60) { setStatus(fireBadge, 'warn', 'ê²½ê³„'); }
        else { setStatus(fireBadge, 'safe', 'ë³´í†µ'); }

        // 4. ê¸°ì˜¨
        const tempEl = document.getElementById('val-temp');
        const tempBadge = document.getElementById('badge-temp');
        tempEl.innerText = `${currentData.temp}Â°C`;
        if(currentData.temp > 33) { setStatus(tempBadge, 'danger', 'í­ì—¼ê²½ë³´'); }
        else if(currentData.temp < -10) { setStatus(tempBadge, 'danger', 'í•œíŒŒê²½ë³´'); }
        else if(currentData.temp < 0) { setStatus(tempBadge, 'warn', 'ë™ì ˆê¸°'); }
        else { setStatus(tempBadge, 'safe', 'ì ì •ê¸°ì˜¨'); }
    }

    function setStatus(element, type, text) {
        element.className = `badge ${type}`;
        element.innerText = text;
        element.parentElement.style.borderColor = (type === 'danger') ? '#fb7185' : '#334155';
    }

    // ëª¨ë‹¬ ìƒì„¸ ì •ë³´ (ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ì—­ë³„ í¸ì°¨ ì‹œë®¬ë ˆì´ì…˜)
    function showDetail(type) {
        const modal = document.getElementById('modal-overlay');
        const title = document.getElementById('modal-title');
        const content = document.getElementById('modal-content');
        const action = document.getElementById('police-action');
        
        modal.style.display = 'flex';
        let html = '';
        let districts = ['ì¡°ì¹˜ì›ì', 'ì—°ì„œë©´', 'ì–´ì§„ë™', 'ë³´ëŒë™', 'ê¸ˆë‚¨ë©´'];
        
        // ë°ì´í„° ì¤€ë¹„
        let baseVal = 0;
        let unit = '';
        let policeMsg = '';

        if(type === 'rain') {
            title.innerText = 'ğŸŒ§ï¸ ê´€ë‚´ ê°•ìˆ˜ëŸ‰ ìƒì„¸';
            baseVal = currentData.rain; unit = 'mm';
            policeMsg = baseVal > 10 ? 'ì €ì§€ëŒ€ ë° í•˜ìƒë„ë¡œ ì¹¨ìˆ˜ ìš°ë ¤, ìˆœì°°ì°¨ ê±°ì  ë°°ì¹˜' : 'íŠ¹ì´ì‚¬í•­ ì—†ìŒ, í‰ì‹œ ë°©ë²” í™œë™ ìˆ˜í–‰';
        } else if(type === 'snow') {
            title.innerText = 'ğŸŒ¨ï¸ ê´€ë‚´ ì ì„¤ëŸ‰ ìƒì„¸';
            baseVal = currentData.snow; unit = 'cm';
            policeMsg = baseVal > 1 ? 'ì£¼ìš” êµì°¨ë¡œ ë° ê²½ì‚¬ë¡œ ì œì„¤ ìš”ì²­, êµí†µ í†µì œ ì¤€ë¹„' : 'ê²°ë¹™ êµ¬ê°„ ì£¼ì˜ ìš´ì „ ê³„ë„';
        } else if(type === 'fire') {
            title.innerText = 'ğŸ”¥ ìë©´ë™ ì‚°ë¶ˆìœ„í—˜ë„';
            baseVal = currentData.fireIdx; unit = '';
            policeMsg = baseVal > 60 ? 'ì‚°ë¦¼ ì¸ì ‘ì§€ ì†Œê° í–‰ìœ„ ì§‘ì¤‘ ë‹¨ì†, ë“±ì‚°ë¡œ ìˆœì°°' : 'ì‚°ë¶ˆ ì˜ˆë°© ì•ˆë‚´ ë°©ì†¡ ì‹¤ì‹œ';
        } else if(type === 'temp') {
            title.innerText = 'ğŸŒ¡ï¸ ì§€ì—­ë³„ ì‹¤ì‹œê°„ ê¸°ì˜¨';
            baseVal = currentData.temp; unit = 'Â°C';
            policeMsg = baseVal < -5 ? 'í•œíŒŒ ì‰¼í„° ì ê²€ ë° ì£¼ì·¨ì ë™ì‚¬ ì˜ˆë°© í™œë™ ê°•í™”' : (baseVal > 30 ? 'í­ì—¼ ì‹œê°„ëŒ€ ì•¼ì™¸ í™œë™ ìì œ ê¶Œê³ ' : 'ìƒí™œ ì•ˆì „ ìˆœì°° ê°•í™”');
        }

        // ìƒì„¸ ëª©ë¡ ìƒì„± (ì‹¤ì œê°’ +- í¸ì°¨ ì ìš©)
        districts.forEach(d => {
            // ëœë¤ í¸ì°¨ (-1 ~ +1 ì •ë„)
            let variance = (Math.random() * 2 - 1).toFixed(1);
            let val = (parseFloat(baseVal) + parseFloat(variance)).toFixed(1);
            if(val < 0 && type !== 'temp') val = 0; // ê¸°ì˜¨ ì™¸ì—ëŠ” ìŒìˆ˜ ë°©ì§€

            html += `<div class="detail-row">
                        <span>${d}</span>
                        <span style="font-weight:bold; color:white;">${val}${unit}</span>
                     </div>`;
        });

        content.innerHTML = html;
        action.innerText = policeMsg;
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
    }

    function addLog(type, msg) {
        const box = document.getElementById('log-box');
        const time = new Date().toLocaleTimeString();
        const color = type === 'ERROR' ? '#fb7185' : (type === 'SUCCESS' ? '#4ade80' : '#f8fafc');
        box.innerHTML = `<div class="log-item"><span style="color:#94a3b8">[${time}]</span> <span style="color:${color}">${msg}</span></div>` + box.innerHTML;
    }
</script>

</body>
</html>
